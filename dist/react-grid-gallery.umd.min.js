!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t(require("prop-types"),require("react"),require("react-images")):"function"==typeof define&&define.amd?define(["prop-types","react","react-images"],t):(e=e||self).ReactGridGallery=t(e.PropTypes,e.React,e.Carousel)}(this,function(e,t,l){"use strict";e=e&&e.hasOwnProperty("default")?e.default:e;var p="default"in t?t.default:t,c="default"in l?l.default:l;var r=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")};function i(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var o=function(e,t,r){return t&&i(e.prototype,t),r&&i(e,r),e};function n(e,t){return e(t={exports:{}},t.exports),t.exports}var a=n(function(t){function r(e){return"function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?t.exports=r=function(e){return typeof e}:t.exports=r=function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r(e)}t.exports=r});var s=function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e};var h=function(e,t){return!t||"object"!==a(t)&&"function"!=typeof t?s(e):t},u=n(function(t){function r(e){return t.exports=r=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},r(e)}t.exports=r}),m=n(function(r){function i(e,t){return r.exports=i=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},i(e,t)}r.exports=i});var g=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&m(e,t)};var d,b=function(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e},f=(d=t.Component,g(v,d),o(v,[{key:"fill",value:function(){return this.props.isSelected?this.props.selectedColor:this.state.hover?this.props.hoverColor:this.props.color}},{key:"visibility",value:function(){return this.props.isSelected||this.props.isSelectable&&this.props.parentHover?"visible":"hidden"}},{key:"render",value:function(){var t=this,e={display:this.props.isSelected?"block":"none"};return p.createElement("div",{title:"Select",style:{visibility:this.visibility(),background:"none",float:"left",width:"36px",height:"36px",border:"none",padding:"6px",cursor:"pointer",pointerEvents:"visible"},onClick:this.props.onClick?function(e){return t.props.onClick(t.props.index,e)}:null,onMouseOver:function(){return t.setState({hover:!0})},onMouseOut:function(){return t.setState({hover:!1})}},p.createElement("svg",{fill:this.fill(),height:"24",viewBox:"0 0 24 24",width:"24",xmlns:"http://www.w3.org/2000/svg"},p.createElement("radialGradient",{id:"shadow",cx:"38",cy:"95.488",r:"10.488",gradientTransform:"matrix(1 0 0 -1 -26 109)",gradientUnits:"userSpaceOnUse"},p.createElement("stop",{offset:".832",stopColor:"#010101"}),p.createElement("stop",{offset:"1",stopColor:"#010101",stopOpacity:"0"})),p.createElement("circle",{style:e,opacity:".26",fill:"url(#shadow)",cx:"12",cy:"13.512",r:"10.488"}),p.createElement("circle",{style:e,fill:"#FFF",cx:"12",cy:"12.2",r:"8.292"}),p.createElement("path",{d:"M0 0h24v24H0z",fill:"none"}),p.createElement("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"})))}}]),v);function v(e){var t;return r(this,v),(t=h(this,u(v).call(this,e))).state={hover:t.props.hover},t.fill=t.fill.bind(s(t)),t.visibility=t.visibility.bind(s(t)),t}f.propTypes={index:e.number,color:e.string,isSelectable:e.bool,isSelected:e.bool,selectedColor:e.string,parentHover:e.bool,hover:e.bool,hoverColor:e.string,onClick:e.func},f.defaultProps={isSelectable:!0,isSelected:!1,parentHover:!1,hover:!1};var y,x=(y=t.Component,g(S,y),o(S,[{key:"tagStyle",value:function(){return this.props.tagStyle?this.props.tagStyle:{display:"inline",padding:".2em .6em .3em",fontSize:"75%",fontWeight:"600",lineHeight:"1",color:"yellow",background:"rgba(0,0,0,0.65)",textAlign:"center",whiteSpace:"nowrap",verticalAlign:"baseline",borderRadius:".25em"}}},{key:"tileViewportStyle",value:function(){if(this.props.tileViewportStyle)return this.props.tileViewportStyle.call(this);var e={};return this.props.item.nano&&(e={background:"url(".concat(this.props.item.nano,")"),backgroundSize:"cover",backgroundPosition:"center center"}),this.props.item.isSelected?Object.assign({width:this.props.item.vwidth-32,height:this.props.height-32,margin:16,overflow:"hidden"},e):Object.assign({width:this.props.item.vwidth,height:this.props.height,overflow:"hidden"},e)}},{key:"thumbnailStyle",value:function(){if(this.props.thumbnailStyle)return this.props.thumbnailStyle.call(this);var e=void 0;switch(this.props.item.orientation){case 3:e="rotate(180deg)";break;case 6:e="rotate(90deg)";break;case 8:e="rotate(270deg)";break;case 2:e="rotateY(180deg)";break;case 4:e="rotate(180deg) rotateY(180deg)";break;case 5:e="rotate(270deg) rotateY(180deg)";break;case 7:e="rotate(90deg) rotateY(180deg)"}if(this.props.item.isSelected){var t=this.props.item.scaletwidth/this.props.height,r=0,i=0,o=this.props.height-32,n=this.props.item.vwidth-32;this.props.item.scaletwidth>this.props.height?(i=this.props.item.scaletwidth-32,r=Math.floor(i/t)):(r=this.props.height-32,i=Math.floor(r*t));var a=-Math.abs(Math.floor((o-r)/2));return{cursor:"pointer",width:i,height:r,marginLeft:-Math.abs(Math.floor((n-i)/2)),marginTop:a,transform:e}}return{cursor:"pointer",width:this.props.item.scaletwidth,height:this.props.height,marginLeft:this.props.item.marginLeft,marginTop:0,transform:e}}},{key:"renderCheckButton",value:function(){return p.createElement(f,{key:"Select",index:this.props.index,color:"rgba(255, 255, 255, 0.7)",selectedColor:"#4285f4",hoverColor:"rgba(255, 255, 255, 1)",isSelected:this.props.item.isSelected,isSelectable:this.props.isSelectable,onClick:this.props.isSelectable?this.props.onSelectImage:null,parentHover:this.state.hover})}},{key:"render",value:function(){var t=this,e=this.props.item.alt?this.props.item.alt:"",r=void 0===this.props.item.tags?p.createElement("noscript",null):this.props.item.tags.map(function(e){return p.createElement("div",{title:e.title,key:"tag-"+e.value,style:{display:"inline-block",cursor:"pointer",pointerEvents:"visible",margin:"2px"}},p.createElement("span",{style:t.tagStyle()},e.value))}),i=void 0===this.props.item.customOverlay?p.createElement("noscript",null):p.createElement("div",{className:"ReactGridGallery_custom-overlay",key:"custom-overlay-"+this.props.index,style:{pointerEvents:"none",opacity:this.state.hover?1:0,position:"absolute",height:"100%",width:"100%"}},this.props.item.customOverlay),o=null;this.props.DirItem&&(o=this.props.DirItem);var n=this.props.item.isDir,a=this.props.onClick?function(e){return t.props.onClick.call(t,t.props.index,e)}:null;return n&&(a=null),p.createElement("div",{className:"ReactGridGallery_tile",key:"tile-"+this.props.index,onMouseEnter:function(){return t.setState({hover:!0})},onMouseLeave:function(){return t.setState({hover:!1})},style:{margin:this.props.margin,WebkitUserSelect:"none",position:"relative",float:"left",background:"#eee",padding:"0px"}},p.createElement("div",{className:"ReactGridGallery_tile-icon-bar",key:"tile-icon-bar-"+this.props.index,style:{pointerEvents:"none",opacity:1,position:"absolute",height:"36px",width:"100%"}},this.renderCheckButton()),p.createElement("div",{className:"ReactGridGallery_tile-bottom-bar",key:"tile-bottom-bar-"+this.props.index,style:{padding:"2px",pointerEvents:"none",position:"absolute",minHeight:"0px",maxHeight:"160px",width:"100%",bottom:"0px",overflow:"hidden"}},r),i,p.createElement("div",{className:"ReactGridGallery_tile-overlay",key:"tile-overlay-"+this.props.index,style:{pointerEvents:"none",opacity:1,position:"absolute",height:"100%",width:"100%",background:this.state.hover&&!this.props.item.isSelected&&this.props.isSelectable?"linear-gradient(to bottom,rgba(0,0,0,0.26),transparent 56px,transparent)":"none"}}),p.createElement("div",{className:"ReactGridGallery_tile-viewport",style:this.tileViewportStyle(),key:"tile-viewport-"+this.props.index,onClick:a},n?o?p.createElement(o,{item:this.props.item}):null:p.createElement("img",{key:"img-"+this.props.index,src:"".concat(this.props.item.thumbnail),alt:e,title:this.props.item.caption,style:this.thumbnailStyle()})),this.props.item.thumbnailCaption&&p.createElement("div",{className:"ReactGridGallery_tile-description",style:{background:"white",height:"100%",width:"100%",margin:0,userSelect:"text",WebkitUserSelect:"text",MozUserSelect:"text",overflow:"hidden"}},this.props.item.thumbnailCaption))}}]),S);function S(e){var t;return r(this,S),(t=h(this,u(S).call(this,e))).state={hover:!1},t}x.propTypes={item:e.object,index:e.number,margin:e.number,height:e.number,isSelectable:e.bool,onClick:e.func,onSelectImage:e.func,tileViewportStyle:e.func,thumbnailStyle:e.func,tagStyle:e.object,customOverlay:e.element},x.defaultProps={isSelectable:!0,hover:!1};var w=function(e,t){if(null==e)return{};var r,i,o={},n=Object.keys(e);for(i=0;i<n.length;i++)r=n[i],0<=t.indexOf(r)||(o[r]=e[r]);return o};var k=function(e,t){if(null==e)return{};var r,i,o=w(e,t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);for(i=0;i<n.length;i++)r=n[i],0<=t.indexOf(r)||Object.prototype.propertyIsEnumerable.call(e,r)&&(o[r]=e[r])}return o};function I(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),r.push.apply(r,i)}return r}function C(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?I(Object(r),!0).forEach(function(e){b(t,e,r[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):I(Object(r)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))})}return t}var O,E=(O=t.Component,g(D,O),o(D,[{key:"render",value:function(){var e=this.props.bbtn;return p.createElement("div",{className:"boxesGroup"},e,this.makeBoxes())}}],[{key:"getDerivedStateFromProps",value:function(e){return{boxes:e.items.map(function(e,t){return{el:e,id:t,name:"BOX1",color:"red"}})}}}]),D);function D(e){var c;return r(this,D),c=h(this,u(D).call(this,e)),b(s(c),"swapBoxes",function(e,t){for(var r=c.state.boxes.slice(),i=-1,o=-1,n=0;n<r.length;n++)r[n].id===e.id&&(i=n),r[n].id===t.id&&(o=n);if(-1!==i&&-1!==o){var a=r[i],s=(a.fromId,k(a,["fromId"])),l=r[o],p=(l.toId,k(l,["toId"]));r[i]=C({id:e.id},p),r[o]=C({id:t.id},s),c.setState({boxes:r},function(){return c.props.onDrop(r.map(function(e){return e.el}))})}}),b(s(c),"handleDragStart",function(r){return function(e){var t=JSON.stringify({id:r});e.dataTransfer.setData("dragContent",t)}}),b(s(c),"handleDragOver",function(){return function(e){return e.preventDefault(),!1}}),b(s(c),"handleDrop",function(i){return function(e){e.preventDefault();var t=JSON.parse(e.dataTransfer.getData("dragContent")),r={id:i};return c.swapBoxes(t,r),!1}}),b(s(c),"makeBoxes",function(){return c.state.boxes.map(function(e){var t=e.el,r=e.id;return p.createElement("div",{key:r,className:"box",draggable:!0,onDragStart:c.handleDragStart(r),onDragOver:c.handleDragOver(),onDrop:c.handleDrop(r)},p.createElement("div",{className:"content"},c.props.renderItem(C({},t,{id:r}))))})}),c.state={boxes:[]},c}var R,W=(R=t.Component,g(j,R),o(j,[{key:"componentDidMount",value:function(){this.onResize()}},{key:"componentDidUpdate",value:function(){j._gallery&&j._gallery.clientWidth!==this.state.containerWidth&&this.onResize()}},{key:"openLightbox",value:function(e,t){t&&t.preventDefault(),this.props.lightboxWillOpen&&this.props.lightboxWillOpen.call(this,e),this.props.currentImageWillChange&&this.props.currentImageWillChange.call(this,e),this.setState({currentImage:e,lightboxIsOpen:!0})}},{key:"closeLightbox",value:function(){this.props.lightboxWillClose&&this.props.lightboxWillClose.call(this),this.props.currentImageWillChange&&this.props.currentImageWillChange.call(this,0),this.setState({currentImage:0,lightboxIsOpen:!1})}},{key:"gotoPrevious",value:function(){this.props.currentImageWillChange&&this.props.currentImageWillChange.call(this,this.state.currentImage-1),this.setState({currentImage:this.state.currentImage-1})}},{key:"gotoNext",value:function(){this.props.currentImageWillChange&&this.props.currentImageWillChange.call(this,this.state.currentImage+1),this.setState({currentImage:this.state.currentImage+1})}},{key:"onClickImage",value:function(){this.state.currentImage!==this.props.images.length-1&&this.gotoNext()}},{key:"onSelectImage",value:function(e,t){t.preventDefault(),this.props.onSelectImage&&this.props.onSelectImage.call(this,e,this.state.images[e])}},{key:"gotoImage",value:function(e){this.props.currentImageWillChange&&this.props.currentImageWillChange.call(this,e),this.setState({currentImage:e})}},{key:"getOnClickThumbnailFn",value:function(){return!this.props.onClickThumbnail&&this.props.enableLightbox?this.openLightbox:this.props.onClickThumbnail?this.props.onClickThumbnail:null}},{key:"renderItem",value:function(e){var t=e.idx;return p.createElement(x,{key:"Image-"+t+"-"+e.src,item:e,index:t,DirItem:this.props.DirItem,margin:this.props.margin,height:this.props.rowHeight,isSelectable:this.props.enableImageSelection,onClick:this.getOnClickThumbnailFn(),onSelectImage:this.onSelectImage,tagStyle:this.props.tagStyle,tileViewportStyle:this.props.tileViewportStyle,thumbnailStyle:this.props.thumbnailStyle})}},{key:"render",value:function(){var r=this,e=this.props,t=e.isDraggable,i=(e.onDrop,e.backButton),o=this.state,n=o.lightboxIsOpen,a=o.thumbnails,s=a.map(function(e,t){return void 0!==e.src&&(e.idx=t),r.renderItem(e)});return t||s.unshift(i),p.createElement("div",{id:this.props.id,className:"ReactGridGallery",ref:function(e){return j._gallery=e}},t&&a.length?p.createElement(E,{onDrop:this.onDrop,items:a,bbtn:i,renderItem:this.renderItem}):s,p.createElement(l.ModalGateway,null,n&&a.length?p.createElement(l.Modal,{onClose:this.closeLightbox},p.createElement(c,{views:a,currentIndex:this.state.currentImage})):null))}}],[{key:"getDerivedStateFromProps",value:function(e,t){return console.log(e.images),t.images!==e.images||e.maxRows!=e.maxRows?{images:e.images,thumbnails:j.renderThumbs(j._gallery.clientWidth,e.images)}:null}},{key:"calculateCutOff",value:function(e,t,r){var i=[],o=0;for(var n in r){var a=r[n].scaletwidth/e;i[n]=Math.floor(a*t),o+=i[n]}for(var s=t-o;0<s;)for(n in i)if(i[n]++,--s<0)break;return i}},{key:"buildImageRow",value:function(e,t){for(var r=[],i=0,o=2*j.margin;0<e.length&&i<t;){var n=e.shift();r.push(n),i+=n.scaletwidth+o}var a=i-t;if(0<r.length&&0<a){var s=j.calculateCutOff(i,a,r);for(var l in r){var p=s[l];(n=r[l]).marginLeft=-Math.abs(Math.floor(p/2)),n.vwidth=n.scaletwidth-p}}else for(var c in r)(n=r[c]).marginLeft=0,n.vwidth=n.scaletwidth;return r}},{key:"setThumbScale",value:function(e){e.scaletwidth=Math.floor(j.rowHeight*(e.thumbnailWidth/e.thumbnailHeight))}},{key:"renderThumbs",value:function(e,t){var r=1<arguments.length&&void 0!==t?t:[];if(!r)return[];if(0===e)return[];var i=r.slice();for(var o in i)j.setThumbScale(i[o]);for(var n=[],a=[];0<i.length;)a.push(j.buildImageRow(i,e));for(var s in a)for(var l in a[s]){var p=a[s][l];j.maxRows?s<j.maxRows&&n.push(p):n.push(p)}return n}}]),j);function j(e){var t;return r(this,j),t=h(this,u(j).call(this,e)),b(s(t),"onResize",function(){j._gallery&&t.setState({containerWidth:Math.floor(j._gallery.clientWidth),thumbnails:j.renderThumbs(j._gallery.clientWidth,t.state.images)})}),b(s(t),"onDrop",function(e){t.setState({thumbnails:e},function(){return t.props.onDrop(e)})}),t.state={images:t.props.images,thumbnails:[],lightboxIsOpen:t.props.isOpen,currentImage:t.props.currentImage,containerWidth:0},j.rowHeight=t.props.rowHeight,j.margin=t.props.margin,j.maxRows=t.props.maxRows,t.closeLightbox=t.closeLightbox.bind(s(t)),t.gotoImage=t.gotoImage.bind(s(t)),t.gotoNext=t.gotoNext.bind(s(t)),t.gotoPrevious=t.gotoPrevious.bind(s(t)),t.onClickImage=t.onClickImage.bind(s(t)),t.openLightbox=t.openLightbox.bind(s(t)),t.onSelectImage=t.onSelectImage.bind(s(t)),t.renderItem=t.renderItem.bind(s(t)),t}return b(W,"rowHeight",void 0),b(W,"margin",void 0),b(W,"maxRows",void 0),W.displayName="Gallery",W.propTypes={images:e.arrayOf(e.shape({src:e.string.isRequired,nano:e.string,alt:e.string,thumbnail:e.string.isRequired,srcset:e.array,caption:e.string,tags:e.arrayOf(e.shape({value:e.string.isRequired,title:e.string.isRequired})),thumbnailWidth:e.number.isRequired,thumbnailHeight:e.number.isRequired,isSelected:e.bool,thumbnailCaption:e.oneOfType([e.string,e.element])})).isRequired,id:e.string,enableImageSelection:e.bool,onSelectImage:e.func,rowHeight:e.number,maxRows:e.number,margin:e.number,onClickThumbnail:e.func,lightboxWillOpen:e.func,lightboxWillClose:e.func,enableLightbox:e.bool,backdropClosesModal:e.bool,currentImage:e.number,preloadNextImage:e.bool,customControls:e.arrayOf(e.node),currentImageWillChange:e.func,enableKeyboardInput:e.bool,imageCountSeparator:e.string,isOpen:e.bool,isDraggable:e.bool,onDrop:e.func,onClickImage:e.func,onClickNext:e.func,onClickPrev:e.func,onClose:e.func,showCloseButton:e.bool,showImageCount:e.bool,lightboxWidth:e.number,tileViewportStyle:e.func,thumbnailStyle:e.func,showLightboxThumbnails:e.bool,onClickLightboxThumbnail:e.func,tagStyle:e.object},W.defaultProps={id:"ReactGridGallery",enableImageSelection:!0,rowHeight:180,margin:2,enableLightbox:!0,backdropClosesModal:!1,currentImage:0,preloadNextImage:!0,enableKeyboardInput:!0,imageCountSeparator:" of ",isOpen:!1,showCloseButton:!0,showImageCount:!0,lightboxWidth:1024,showLightboxThumbnails:!1,onDrop:function(){}},W});
