!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t(require("prop-types"),require("react"),require("react-images")):"function"==typeof define&&define.amd?define(["prop-types","react","react-images"],t):(e=e||self).ReactGridGallery=t(e.PropTypes,e.React,e.Carousel)}(this,function(e,t,l){"use strict";e=e&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e;var c="default"in t?t.default:t,u="default"in l?l.default:l;var n=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")};function i(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var o=function(e,t,r){return t&&i(e.prototype,t),r&&i(e,r),e};var a=function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e};function r(e,t){return e(t={exports:{}},t.exports),t.exports}var s=r(function(r){function i(e,t){return r.exports=i=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},i(e,t)}r.exports=i});var h=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&s(e,t)},p=r(function(t){function r(e){return"function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?t.exports=r=function(e){return typeof e}:t.exports=r=function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r(e)}t.exports=r});var f=function(e,t){return!t||"object"!==p(t)&&"function"!=typeof t?a(e):t},m=r(function(t){function r(e){return t.exports=r=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},r(e)}t.exports=r});var g=function(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e};function d(i){var n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var e,t=m(i);if(n){var r=m(this).constructor;e=Reflect.construct(t,arguments,r)}else e=t.apply(this,arguments);return f(this,e)}}var b=function(e){h(i,e);var r=d(i);function i(e){var t;return n(this,i),(t=r.call(this,e)).state={hover:t.props.hover},t.fill=t.fill.bind(a(t)),t.visibility=t.visibility.bind(a(t)),t}return o(i,[{key:"fill",value:function(){return this.props.isSelected?this.props.selectedColor:this.state.hover?this.props.hoverColor:this.props.color}},{key:"visibility",value:function(){return this.props.isSelected||this.props.isSelectable&&this.props.parentHover?"visible":"hidden"}},{key:"render",value:function(){var t=this,e={display:this.props.isSelected?"block":"none"};return c.createElement("div",{title:"Select",style:{visibility:this.visibility(),background:"none",float:"left",width:"36px",height:"36px",border:"none",padding:"6px",cursor:"pointer",pointerEvents:"visible"},onClick:this.props.onClick?function(e){return t.props.onClick(t.props.index,e)}:null,onMouseOver:function(){return t.setState({hover:!0})},onMouseOut:function(){return t.setState({hover:!1})}},c.createElement("svg",{fill:this.fill(),height:"24",viewBox:"0 0 24 24",width:"24",xmlns:"http://www.w3.org/2000/svg"},c.createElement("radialGradient",{id:"shadow",cx:"38",cy:"95.488",r:"10.488",gradientTransform:"matrix(1 0 0 -1 -26 109)",gradientUnits:"userSpaceOnUse"},c.createElement("stop",{offset:".832",stopColor:"#010101"}),c.createElement("stop",{offset:"1",stopColor:"#010101",stopOpacity:"0"})),c.createElement("circle",{style:e,opacity:".26",fill:"url(#shadow)",cx:"12",cy:"13.512",r:"10.488"}),c.createElement("circle",{style:e,fill:"#FFF",cx:"12",cy:"12.2",r:"8.292"}),c.createElement("path",{d:"M0 0h24v24H0z",fill:"none"}),c.createElement("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"})))}}]),i}(t.Component);function v(i){var n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var e,t=m(i);if(n){var r=m(this).constructor;e=Reflect.construct(t,arguments,r)}else e=t.apply(this,arguments);return f(this,e)}}b.propTypes={index:e.number,color:e.string,isSelectable:e.bool,isSelected:e.bool,selectedColor:e.string,parentHover:e.bool,hover:e.bool,hoverColor:e.string,onClick:e.func},b.defaultProps={isSelectable:!0,isSelected:!1,parentHover:!1,hover:!1};var y=function(e){h(i,e);var r=v(i);function i(e){var t;return n(this,i),(t=r.call(this,e)).state={hover:!1},t}return o(i,[{key:"tagStyle",value:function(){return this.props.tagStyle?this.props.tagStyle:{display:"inline",padding:".2em .6em .3em",fontSize:"75%",fontWeight:"600",lineHeight:"1",color:"yellow",background:"rgba(0,0,0,0.65)",textAlign:"center",whiteSpace:"nowrap",verticalAlign:"baseline",borderRadius:".25em"}}},{key:"tileViewportStyle",value:function(){if(this.props.tileViewportStyle)return this.props.tileViewportStyle.call(this);var e={};return this.props.item.nano&&(e={background:"url(".concat(this.props.item.nano,")"),backgroundSize:"cover",backgroundPosition:"center center"}),this.props.item.isSelected?Object.assign({width:this.props.item.vwidth-32,height:this.props.height-32,margin:16,overflow:"hidden"},e):Object.assign({width:this.props.item.vwidth,height:this.props.height,overflow:"hidden"},e)}},{key:"thumbnailStyle",value:function(){if(this.props.thumbnailStyle)return this.props.thumbnailStyle.call(this);var e=void 0;switch(this.props.item.orientation){case 3:e="rotate(180deg)";break;case 6:e="rotate(90deg)";break;case 8:e="rotate(270deg)";break;case 2:e="rotateY(180deg)";break;case 4:e="rotate(180deg) rotateY(180deg)";break;case 5:e="rotate(270deg) rotateY(180deg)";break;case 7:e="rotate(90deg) rotateY(180deg)"}if(this.props.item.isSelected){var t,r,i=this.props.item.scaletwidth/this.props.height,n=this.props.height-32,o=this.props.item.vwidth-32;this.props.item.scaletwidth>this.props.height?(r=this.props.item.scaletwidth-32,t=Math.floor(r/i)):(t=this.props.height-32,r=Math.floor(t*i));var a=-Math.abs(Math.floor((n-t)/2));return{cursor:"pointer",width:r,height:t,marginLeft:-Math.abs(Math.floor((o-r)/2)),marginTop:a,transform:e}}return{cursor:"pointer",width:this.props.item.scaletwidth,height:this.props.height,marginLeft:this.props.item.marginLeft,marginTop:0,transform:e}}},{key:"renderCheckButton",value:function(){return c.createElement(b,{key:"Select",index:this.props.index,color:"rgba(255, 255, 255, 0.7)",selectedColor:"#4285f4",hoverColor:"rgba(255, 255, 255, 1)",isSelected:this.props.item.isSelected,isSelectable:this.props.isSelectable,onClick:this.props.isSelectable?this.props.onSelectImage:null,parentHover:this.state.hover})}},{key:"render",value:function(){var t=this,e=this.props.item.alt?this.props.item.alt:"",r=void 0===this.props.item.tags?c.createElement("noscript",null):this.props.item.tags.map(function(e){return c.createElement("div",{title:e.title,key:"tag-"+e.value,style:{display:"inline-block",cursor:"pointer",pointerEvents:"visible",margin:"2px"}},c.createElement("span",{style:t.tagStyle()},e.value))}),i=void 0===this.props.item.customOverlay?c.createElement("noscript",null):c.createElement("div",{className:"ReactGridGallery_custom-overlay",key:"custom-overlay-"+this.props.index,style:{pointerEvents:"none",opacity:this.state.hover?1:0,position:"absolute",height:"100%",width:"100%"}},this.props.item.customOverlay),n=null;this.props.DirItem&&(n=this.props.DirItem);var o=this.props.item.isDir,a=this.props.onClick?function(e){return t.props.onClick.call(t,t.props.index,e)}:null;return o&&(a=null),c.createElement("div",{className:"ReactGridGallery_tile",key:"tile-"+this.props.index,onMouseEnter:function(){return t.setState({hover:!0})},onMouseLeave:function(){return t.setState({hover:!1})},style:{margin:this.props.margin,WebkitUserSelect:"none",position:"relative",float:"left",background:"#eee",padding:"0px"}},c.createElement("div",{className:"ReactGridGallery_tile-icon-bar",key:"tile-icon-bar-"+this.props.index,style:{pointerEvents:"none",opacity:1,position:"absolute",height:"36px",width:"100%"}},this.renderCheckButton()),c.createElement("div",{className:"ReactGridGallery_tile-bottom-bar",key:"tile-bottom-bar-"+this.props.index,style:{padding:"2px",pointerEvents:"none",position:"absolute",minHeight:"0px",maxHeight:"160px",width:"100%",bottom:"0px",overflow:"hidden"}},r),i,c.createElement("div",{className:"ReactGridGallery_tile-overlay",key:"tile-overlay-"+this.props.index,style:{pointerEvents:"none",opacity:1,position:"absolute",height:"100%",width:"100%",background:this.state.hover&&!this.props.item.isSelected&&this.props.isSelectable?"linear-gradient(to bottom,rgba(0,0,0,0.26),transparent 56px,transparent)":"none"}}),c.createElement("div",{className:"ReactGridGallery_tile-viewport",style:this.tileViewportStyle(),key:"tile-viewport-"+this.props.index,onClick:a},o?n?c.createElement(n,{item:this.props.item}):null:c.createElement("img",{key:"img-"+this.props.index,src:"".concat(this.props.item.thumbnail),alt:e,title:this.props.item.caption,style:this.thumbnailStyle()})),this.props.item.thumbnailCaption&&c.createElement("div",{className:"ReactGridGallery_tile-description",style:{background:"white",height:"100%",width:"100%",margin:0,userSelect:"text",WebkitUserSelect:"text",MozUserSelect:"text",overflow:"hidden"}},this.props.item.thumbnailCaption))}}]),i}(t.Component);y.propTypes={item:e.object,index:e.number,margin:e.number,height:e.number,isSelectable:e.bool,onClick:e.func,onSelectImage:e.func,tileViewportStyle:e.func,thumbnailStyle:e.func,tagStyle:e.object,customOverlay:e.element},y.defaultProps={isSelectable:!0,hover:!1};var x=function(e,t){if(null==e)return{};var r,i,n={},o=Object.keys(e);for(i=0;i<o.length;i++)r=o[i],0<=t.indexOf(r)||(n[r]=e[r]);return n};var S=function(e,t){if(null==e)return{};var r,i,n=x(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(i=0;i<o.length;i++)r=o[i],0<=t.indexOf(r)||Object.prototype.propertyIsEnumerable.call(e,r)&&(n[r]=e[r])}return n};function w(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),r.push.apply(r,i)}return r}function k(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?w(Object(r),!0).forEach(function(e){g(t,e,r[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):w(Object(r)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))})}return t}function I(i){var n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var e,t=m(i);if(n){var r=m(this).constructor;e=Reflect.construct(t,arguments,r)}else e=t.apply(this,arguments);return f(this,e)}}var C=function(e){h(r,e);var t=I(r);function r(e){var u;return n(this,r),u=t.call(this,e),g(a(u),"swapBoxes",function(e,t){for(var r=u.state.boxes.slice(),i=-1,n=-1,o=0;o<r.length;o++)r[o].id===e.id&&(i=o),r[o].id===t.id&&(n=o);if(-1!==i&&-1!==n){var a=r[i],s=(a.fromId,S(a,["fromId"])),l=r[n],c=(l.toId,S(l,["toId"]));r[i]=k({id:e.id},c),r[n]=k({id:t.id},s),u.setState({boxes:r},function(){return u.props.onDrop(r.map(function(e){return e.el}))})}}),g(a(u),"handleDragStart",function(r){return function(e){var t=JSON.stringify({id:r});e.dataTransfer.setData("dragContent",t)}}),g(a(u),"handleDragOver",function(){return function(e){return e.preventDefault(),!1}}),g(a(u),"handleDrop",function(i){return function(e){e.preventDefault();var t=JSON.parse(e.dataTransfer.getData("dragContent")),r={id:i};return u.swapBoxes(t,r),!1}}),g(a(u),"makeBoxes",function(){return u.state.boxes.map(function(e){var t=e.el,r=e.id;return c.createElement("div",{key:r,className:"box",draggable:!0,onDragStart:u.handleDragStart(r),onDragOver:u.handleDragOver(),onDrop:u.handleDrop(r)},c.createElement("div",{className:"content"},u.props.renderItem(k(k({},t),{},{id:r}))))})}),u.state={boxes:[]},u}return o(r,[{key:"render",value:function(){var e=this.props.bbtn;return c.createElement("div",{className:"boxesGroup"},e,this.makeBoxes())}}],[{key:"getDerivedStateFromProps",value:function(e){return{boxes:e.items.map(function(e,t){return{el:e,id:t,name:"BOX1",color:"red"}})}}}]),r}(t.Component);function O(i){var n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var e,t=m(i);if(n){var r=m(this).constructor;e=Reflect.construct(t,arguments,r)}else e=t.apply(this,arguments);return f(this,e)}}var R=function(e){h(p,e);var r=O(p);function p(e){var t;return n(this,p),t=r.call(this,e),g(a(t),"onResize",function(){p._gallery&&t.setState({containerWidth:Math.floor(p._gallery.clientWidth),thumbnails:p.renderThumbs(p._gallery.clientWidth,t.state.images)})}),g(a(t),"onDrop",function(e){t.setState({thumbnails:e},function(){return t.props.onDrop(e)})}),t.state={images:t.props.images,selLen:0,thumbnails:[],lightboxIsOpen:t.props.isOpen,currentImage:t.props.currentImage,containerWidth:0},p.rowHeight=t.props.rowHeight,p.margin=t.props.margin,p.maxRows=t.props.maxRows,t.closeLightbox=t.closeLightbox.bind(a(t)),t.gotoImage=t.gotoImage.bind(a(t)),t.gotoNext=t.gotoNext.bind(a(t)),t.gotoPrevious=t.gotoPrevious.bind(a(t)),t.onClickImage=t.onClickImage.bind(a(t)),t.openLightbox=t.openLightbox.bind(a(t)),t.onSelectImage=t.onSelectImage.bind(a(t)),t.renderItem=t.renderItem.bind(a(t)),t}return o(p,[{key:"componentDidMount",value:function(){this.onResize()}},{key:"componentDidUpdate",value:function(){p._gallery&&p._gallery.clientWidth!==this.state.containerWidth&&this.onResize()}},{key:"openLightbox",value:function(e,t){t&&t.preventDefault(),this.props.lightboxWillOpen&&this.props.lightboxWillOpen.call(this,e),this.props.currentImageWillChange&&this.props.currentImageWillChange.call(this,e),this.setState({currentImage:e,lightboxIsOpen:!0})}},{key:"closeLightbox",value:function(){this.props.lightboxWillClose&&this.props.lightboxWillClose.call(this),this.props.currentImageWillChange&&this.props.currentImageWillChange.call(this,0),this.setState({currentImage:0,lightboxIsOpen:!1})}},{key:"gotoPrevious",value:function(){this.props.currentImageWillChange&&this.props.currentImageWillChange.call(this,this.state.currentImage-1),this.setState({currentImage:this.state.currentImage-1})}},{key:"gotoNext",value:function(){this.props.currentImageWillChange&&this.props.currentImageWillChange.call(this,this.state.currentImage+1),this.setState({currentImage:this.state.currentImage+1})}},{key:"onClickImage",value:function(){this.state.currentImage!==this.props.images.length-1&&this.gotoNext()}},{key:"onSelectImage",value:function(e,t){t.preventDefault(),this.props.onSelectImage&&this.props.onSelectImage.call(this,e,this.state.images[e])}},{key:"gotoImage",value:function(e){this.props.currentImageWillChange&&this.props.currentImageWillChange.call(this,e),this.setState({currentImage:e})}},{key:"getOnClickThumbnailFn",value:function(){return!this.props.onClickThumbnail&&this.props.enableLightbox?this.openLightbox:this.props.onClickThumbnail?this.props.onClickThumbnail:null}},{key:"renderItem",value:function(e){var t=e.idx;return c.createElement(y,{key:"Image-"+t+"-"+e.src,item:e,index:t,DirItem:this.props.DirItem,margin:this.props.margin,height:this.props.rowHeight,isSelectable:this.props.enableImageSelection,onClick:this.getOnClickThumbnailFn(),onSelectImage:this.onSelectImage,tagStyle:this.props.tagStyle,tileViewportStyle:this.props.tileViewportStyle,thumbnailStyle:this.props.thumbnailStyle})}},{key:"render",value:function(){var r=this,e=this.props,t=e.isDraggable,i=e.backButton,n=this.state,o=n.lightboxIsOpen,a=n.thumbnails,s=a.map(function(e,t){return void 0!==e.src&&(e.idx=t),r.renderItem(e)});return t||s.unshift(i),c.createElement("div",{id:this.props.id,className:"ReactGridGallery",ref:function(e){return p._gallery=e}},t&&a.length?c.createElement(C,{onDrop:this.onDrop,items:a,bbtn:i,renderItem:this.renderItem}):s,c.createElement(l.ModalGateway,null,o&&a.length?c.createElement(l.Modal,{onClose:this.closeLightbox},c.createElement(u,{views:a,currentIndex:this.state.currentImage})):null))}}],[{key:"getDerivedStateFromProps",value:function(e,t){var r=e.images.filter(function(e){return e.isSelected}).length;return t.images!==e.images||e.maxRows!=e.maxRows||r!==t.selLen?{images:e.images,selLen:r,thumbnails:p.renderThumbs(p._gallery.clientWidth,e.images)}:null}},{key:"calculateCutOff",value:function(e,t,r){var i=[],n=0;for(var o in r){var a=r[o].scaletwidth/e;i[o]=Math.floor(a*t),n+=i[o]}for(var s=t-n;0<s;)for(o in i)if(i[o]++,--s<0)break;return i}},{key:"buildImageRow",value:function(e,t){for(var r=[],i=0,n=2*p.margin;0<e.length&&i<t;){var o=e.shift();r.push(o),i+=o.scaletwidth+n}var a=i-t;if(0<r.length&&0<a){var s=p.calculateCutOff(i,a,r);for(var l in r){var c=s[l];(o=r[l]).marginLeft=-Math.abs(Math.floor(c/2)),o.vwidth=o.scaletwidth-c}}else for(var u in r)(o=r[u]).marginLeft=0,o.vwidth=o.scaletwidth;return r}},{key:"setThumbScale",value:function(e){e.scaletwidth=Math.floor(p.rowHeight*(e.thumbnailWidth/e.thumbnailHeight))}},{key:"renderThumbs",value:function(e,t){var r=1<arguments.length&&void 0!==t?t:[];if(!r)return[];if(0===e)return[];var i=r.slice();for(var n in i)p.setThumbScale(i[n]);for(var o=[],a=[];0<i.length;)a.push(p.buildImageRow(i,e));for(var s in a)for(var l in a[s]){var c=a[s][l];p.maxRows?s<p.maxRows&&o.push(c):o.push(c)}return o}}]),p}(t.Component);return g(R,"rowHeight",void 0),g(R,"margin",void 0),g(R,"maxRows",void 0),R.displayName="Gallery",R.propTypes={images:e.arrayOf(e.shape({src:e.string.isRequired,nano:e.string,alt:e.string,thumbnail:e.string.isRequired,srcset:e.array,caption:e.string,tags:e.arrayOf(e.shape({value:e.string.isRequired,title:e.string.isRequired})),thumbnailWidth:e.number.isRequired,thumbnailHeight:e.number.isRequired,isSelected:e.bool,thumbnailCaption:e.oneOfType([e.string,e.element])})).isRequired,id:e.string,enableImageSelection:e.bool,onSelectImage:e.func,rowHeight:e.number,maxRows:e.number,margin:e.number,onClickThumbnail:e.func,lightboxWillOpen:e.func,lightboxWillClose:e.func,enableLightbox:e.bool,backdropClosesModal:e.bool,currentImage:e.number,preloadNextImage:e.bool,customControls:e.arrayOf(e.node),currentImageWillChange:e.func,enableKeyboardInput:e.bool,imageCountSeparator:e.string,isOpen:e.bool,isDraggable:e.bool,onDrop:e.func,onClickImage:e.func,onClickNext:e.func,onClickPrev:e.func,onClose:e.func,showCloseButton:e.bool,showImageCount:e.bool,lightboxWidth:e.number,tileViewportStyle:e.func,thumbnailStyle:e.func,showLightboxThumbnails:e.bool,onClickLightboxThumbnail:e.func,tagStyle:e.object},R.defaultProps={id:"ReactGridGallery",enableImageSelection:!0,rowHeight:180,margin:2,enableLightbox:!0,backdropClosesModal:!1,currentImage:0,preloadNextImage:!0,enableKeyboardInput:!0,imageCountSeparator:" of ",isOpen:!1,showCloseButton:!0,showImageCount:!0,lightboxWidth:1024,showLightboxThumbnails:!1,onDrop:function(){}},R});
