!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t(require("prop-types"),require("react"),require("react-images")):"function"==typeof define&&define.amd?define(["prop-types","react","react-images"],t):(e=e||self).ReactGridGallery=t(e.PropTypes,e.React,e.Carousel)}(this,function(e,t,p){"use strict";e=e&&e.hasOwnProperty("default")?e.default:e;var h="default"in t?t.default:t,c="default"in p?p.default:p;var r=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")};function i(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var n=function(e,t,r){return t&&i(e.prototype,t),r&&i(e,r),e};function o(e,t){return e(t={exports:{}},t.exports),t.exports}var s=o(function(t){function r(e){return"function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?t.exports=r=function(e){return typeof e}:t.exports=r=function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r(e)}t.exports=r});var a=function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e};var l=function(e,t){return!t||"object"!==s(t)&&"function"!=typeof t?a(e):t},u=o(function(t){function r(e){return t.exports=r=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},r(e)}t.exports=r}),m=o(function(r){function i(e,t){return r.exports=i=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},i(e,t)}r.exports=i});var g,d=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&m(e,t)},b=(g=t.Component,d(f,g),n(f,[{key:"fill",value:function(){return this.props.isSelected?this.props.selectedColor:this.state.hover?this.props.hoverColor:this.props.color}},{key:"visibility",value:function(){return this.props.isSelected||this.props.isSelectable&&this.props.parentHover?"visible":"hidden"}},{key:"render",value:function(){var t=this,e={display:this.props.isSelected?"block":"none"};return h.createElement("div",{title:"Select",style:{visibility:this.visibility(),background:"none",float:"left",width:"36px",height:"36px",border:"none",padding:"6px",cursor:"pointer",pointerEvents:"visible"},onClick:this.props.onClick?function(e){return t.props.onClick(t.props.index,e)}:null,onMouseOver:function(){return t.setState({hover:!0})},onMouseOut:function(){return t.setState({hover:!1})}},h.createElement("svg",{fill:this.fill(),height:"24",viewBox:"0 0 24 24",width:"24",xmlns:"http://www.w3.org/2000/svg"},h.createElement("radialGradient",{id:"shadow",cx:"38",cy:"95.488",r:"10.488",gradientTransform:"matrix(1 0 0 -1 -26 109)",gradientUnits:"userSpaceOnUse"},h.createElement("stop",{offset:".832",stopColor:"#010101"}),h.createElement("stop",{offset:"1",stopColor:"#010101",stopOpacity:"0"})),h.createElement("circle",{style:e,opacity:".26",fill:"url(#shadow)",cx:"12",cy:"13.512",r:"10.488"}),h.createElement("circle",{style:e,fill:"#FFF",cx:"12",cy:"12.2",r:"8.292"}),h.createElement("path",{d:"M0 0h24v24H0z",fill:"none"}),h.createElement("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"})))}}]),f);function f(e){var t;return r(this,f),(t=l(this,u(f).call(this,e))).state={hover:t.props.hover},t.fill=t.fill.bind(a(t)),t.visibility=t.visibility.bind(a(t)),t}b.propTypes={index:e.number,color:e.string,isSelectable:e.bool,isSelected:e.bool,selectedColor:e.string,parentHover:e.bool,hover:e.bool,hoverColor:e.string,onClick:e.func},b.defaultProps={isSelectable:!0,isSelected:!1,parentHover:!1,hover:!1};var v,y=(v=t.Component,d(x,v),n(x,[{key:"tagStyle",value:function(){return this.props.tagStyle?this.props.tagStyle:{display:"inline",padding:".2em .6em .3em",fontSize:"75%",fontWeight:"600",lineHeight:"1",color:"yellow",background:"rgba(0,0,0,0.65)",textAlign:"center",whiteSpace:"nowrap",verticalAlign:"baseline",borderRadius:".25em"}}},{key:"tileViewportStyle",value:function(){if(this.props.tileViewportStyle)return this.props.tileViewportStyle.call(this);var e={};return this.props.item.nano&&(e={background:"url(".concat(this.props.item.nano,")"),backgroundSize:"cover",backgroundPosition:"center center"}),this.props.item.isSelected?Object.assign({width:this.props.item.vwidth-32,height:this.props.height-32,margin:16,overflow:"hidden"},e):Object.assign({width:this.props.item.vwidth,height:this.props.height,overflow:"hidden"},e)}},{key:"thumbnailStyle",value:function(){if(this.props.thumbnailStyle)return this.props.thumbnailStyle.call(this);var e=void 0;switch(this.props.item.orientation){case 3:e="rotate(180deg)";break;case 6:e="rotate(90deg)";break;case 8:e="rotate(270deg)";break;case 2:e="rotateY(180deg)";break;case 4:e="rotate(180deg) rotateY(180deg)";break;case 5:e="rotate(270deg) rotateY(180deg)";break;case 7:e="rotate(90deg) rotateY(180deg)"}if(this.props.item.isSelected){var t=this.props.item.scaletwidth/this.props.height,r=0,i=0,n=this.props.height-32,o=this.props.item.vwidth-32;this.props.item.scaletwidth>this.props.height?(i=this.props.item.scaletwidth-32,r=Math.floor(i/t)):(r=this.props.height-32,i=Math.floor(r*t));var s=-Math.abs(Math.floor((n-r)/2));return{cursor:"pointer",width:i,height:r,marginLeft:-Math.abs(Math.floor((o-i)/2)),marginTop:s,transform:e}}return{cursor:"pointer",width:this.props.item.scaletwidth,height:this.props.height,marginLeft:this.props.item.marginLeft,marginTop:0,transform:e}}},{key:"renderCheckButton",value:function(){return h.createElement(b,{key:"Select",index:this.props.index,color:"rgba(255, 255, 255, 0.7)",selectedColor:"#4285f4",hoverColor:"rgba(255, 255, 255, 1)",isSelected:this.props.item.isSelected,isSelectable:this.props.isSelectable,onClick:this.props.isSelectable?this.props.onSelectImage:null,parentHover:this.state.hover})}},{key:"render",value:function(){var t=this,e=this.props.item.alt?this.props.item.alt:"",r=void 0===this.props.item.tags?h.createElement("noscript",null):this.props.item.tags.map(function(e){return h.createElement("div",{title:e.title,key:"tag-"+e.value,style:{display:"inline-block",cursor:"pointer",pointerEvents:"visible",margin:"2px"}},h.createElement("span",{style:t.tagStyle()},e.value))}),i=void 0===this.props.item.customOverlay?h.createElement("noscript",null):h.createElement("div",{className:"ReactGridGallery_custom-overlay",key:"custom-overlay-"+this.props.index,style:{pointerEvents:"none",opacity:this.state.hover?1:0,position:"absolute",height:"100%",width:"100%"}},this.props.item.customOverlay),n=null;this.props.DirItem&&(n=this.props.DirItem);var o=this.props.item.isDir,s=this.props.onClick?function(e){return t.props.onClick.call(t,t.props.index,e)}:null;return o&&(s=null),h.createElement("div",{className:"ReactGridGallery_tile",key:"tile-"+this.props.index,onMouseEnter:function(){return t.setState({hover:!0})},onMouseLeave:function(){return t.setState({hover:!1})},style:{margin:this.props.margin,WebkitUserSelect:"none",position:"relative",float:"left",background:"#eee",padding:"0px"}},h.createElement("div",{className:"ReactGridGallery_tile-icon-bar",key:"tile-icon-bar-"+this.props.index,style:{pointerEvents:"none",opacity:1,position:"absolute",height:"36px",width:"100%"}},this.renderCheckButton()),h.createElement("div",{className:"ReactGridGallery_tile-bottom-bar",key:"tile-bottom-bar-"+this.props.index,style:{padding:"2px",pointerEvents:"none",position:"absolute",minHeight:"0px",maxHeight:"160px",width:"100%",bottom:"0px",overflow:"hidden"}},r),i,h.createElement("div",{className:"ReactGridGallery_tile-overlay",key:"tile-overlay-"+this.props.index,style:{pointerEvents:"none",opacity:1,position:"absolute",height:"100%",width:"100%",background:this.state.hover&&!this.props.item.isSelected&&this.props.isSelectable?"linear-gradient(to bottom,rgba(0,0,0,0.26),transparent 56px,transparent)":"none"}}),h.createElement("div",{className:"ReactGridGallery_tile-viewport",style:this.tileViewportStyle(),key:"tile-viewport-"+this.props.index,onClick:s},o?n?h.createElement(n,{item:this.props.item}):null:h.createElement("img",{key:"img-"+this.props.index,src:this.props.item.thumbnail,alt:e,title:this.props.item.caption,style:this.thumbnailStyle()})),this.props.item.thumbnailCaption&&h.createElement("div",{className:"ReactGridGallery_tile-description",style:{background:"white",height:"100%",width:"100%",margin:0,userSelect:"text",WebkitUserSelect:"text",MozUserSelect:"text",overflow:"hidden"}},this.props.item.thumbnailCaption))}}]),x);function x(e){var t;return r(this,x),(t=l(this,u(x).call(this,e))).state={hover:!1},t}y.propTypes={item:e.object,index:e.number,margin:e.number,height:e.number,isSelectable:e.bool,onClick:e.func,onSelectImage:e.func,tileViewportStyle:e.func,thumbnailStyle:e.func,tagStyle:e.object,customOverlay:e.element},y.defaultProps={isSelectable:!0,hover:!1};var S=function(e,t){if(null==e)return{};var r,i,n={},o=Object.keys(e);for(i=0;i<o.length;i++)r=o[i],0<=t.indexOf(r)||(n[r]=e[r]);return n};var k=function(e,t){if(null==e)return{};var r,i,n=S(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(i=0;i<o.length;i++)r=o[i],0<=t.indexOf(r)||Object.prototype.propertyIsEnumerable.call(e,r)&&(n[r]=e[r])}return n};var w=function(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e};function I(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),r.push.apply(r,i)}return r}function C(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?I(Object(r),!0).forEach(function(e){w(t,e,r[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):I(Object(r)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))})}return t}var O,E=(O=t.Component,d(D,O),n(D,[{key:"render",value:function(){var e=this.props.bbtn;return h.createElement("div",{className:"boxesGroup"},e,this.makeBoxes())}}]),D);function D(e){var c;r(this,D),c=l(this,u(D).call(this,e)),w(a(c),"swapBoxes",function(e,t){for(var r=c.state.boxes.slice(),i=-1,n=-1,o=0;o<r.length;o++)r[o].id===e.id&&(i=o),r[o].id===t.id&&(n=o);if(-1!==i&&-1!==n){var s=r[i],a=(s.fromId,k(s,["fromId"])),l=r[n],p=(l.toId,k(l,["toId"]));r[i]=C({id:e.id},p),r[n]=C({id:t.id},a),c.setState({boxes:r},function(){return c.props.onDrop(r.map(function(e){return e.el}))})}}),w(a(c),"handleDragStart",function(r){return function(e){var t=JSON.stringify({id:r});e.dataTransfer.setData("dragContent",t)}}),w(a(c),"handleDragOver",function(){return function(e){return e.preventDefault(),!1}}),w(a(c),"handleDrop",function(i){return function(e){e.preventDefault();var t=JSON.parse(e.dataTransfer.getData("dragContent")),r={id:i};return c.swapBoxes(t,r),!1}}),w(a(c),"makeBoxes",function(){return c.state.boxes.map(function(e){var t=e.el,r=e.id;return h.createElement("div",{key:r,className:"box",draggable:!0,onDragStart:c.handleDragStart(r),onDragOver:c.handleDragOver(),onDrop:c.handleDrop(r)},h.createElement("div",{className:"content"},c.props.renderItem(t)))})});var t=e.items.map(function(e,t){return{el:e,id:t,name:"BOX1",color:"red"}});return c.state={boxes:t},c}var R,W=(R=t.Component,d(j,R),n(j,[{key:"componentDidMount",value:function(){this.onResize()}},{key:"componentDidUpdate",value:function(){this._gallery&&this._gallery.clientWidth!==this.state.containerWidth&&this.onResize()}},{key:"onResize",value:function(){this._gallery&&this.setState({containerWidth:Math.floor(this._gallery.clientWidth),thumbnails:this.renderThumbs(this._gallery.clientWidth)})}},{key:"openLightbox",value:function(e,t){t&&t.preventDefault(),this.props.lightboxWillOpen&&this.props.lightboxWillOpen.call(this,e),this.props.currentImageWillChange&&this.props.currentImageWillChange.call(this,e),this.setState({currentImage:e,lightboxIsOpen:!0})}},{key:"closeLightbox",value:function(){this.props.lightboxWillClose&&this.props.lightboxWillClose.call(this),this.props.currentImageWillChange&&this.props.currentImageWillChange.call(this,0),this.setState({currentImage:0,lightboxIsOpen:!1})}},{key:"gotoPrevious",value:function(){this.props.currentImageWillChange&&this.props.currentImageWillChange.call(this,this.state.currentImage-1),this.setState({currentImage:this.state.currentImage-1})}},{key:"gotoNext",value:function(){this.props.currentImageWillChange&&this.props.currentImageWillChange.call(this,this.state.currentImage+1),this.setState({currentImage:this.state.currentImage+1})}},{key:"onClickImage",value:function(){this.state.currentImage!==this.props.images.length-1&&this.gotoNext()}},{key:"onSelectImage",value:function(e,t){t.preventDefault(),this.props.onSelectImage&&this.props.onSelectImage.call(this,e,this.state.images[e])}},{key:"gotoImage",value:function(e){this.props.currentImageWillChange&&this.props.currentImageWillChange.call(this,e),this.setState({currentImage:e})}},{key:"getOnClickThumbnailFn",value:function(){return!this.props.onClickThumbnail&&this.props.enableLightbox?this.openLightbox:this.props.onClickThumbnail?this.props.onClickThumbnail:null}},{key:"calculateCutOff",value:function(e,t,r){var i=[],n=0;for(var o in r){var s=r[o].scaletwidth/e;i[o]=Math.floor(s*t),n+=i[o]}for(var a=t-n;0<a;)for(o in i)if(i[o]++,--a<0)break;return i}},{key:"buildImageRow",value:function(e,t){for(var r=[],i=0,n=2*this.props.margin;0<e.length&&i<t;){var o=e.shift();r.push(o),i+=o.scaletwidth+n}var s=i-t;if(0<r.length&&0<s){var a=this.calculateCutOff(i,s,r);for(var l in r){var p=a[l];(o=r[l]).marginLeft=-Math.abs(Math.floor(p/2)),o.vwidth=o.scaletwidth-p}}else for(var c in r)(o=r[c]).marginLeft=0,o.vwidth=o.scaletwidth;return r}},{key:"setThumbScale",value:function(e){e.scaletwidth=Math.floor(this.props.rowHeight*(e.thumbnailWidth/e.thumbnailHeight))}},{key:"renderThumbs",value:function(e,t){var r=1<arguments.length&&void 0!==t?t:this.state.images;if(!r)return[];if(0===e)return[];var i=r.slice();for(var n in i)this.setThumbScale(i[n]);for(var o=[],s=[];0<i.length;)s.push(this.buildImageRow(i,e));for(var a in s)for(var l in s[a]){var p=s[a][l];this.props.maxRows?a<this.props.maxRows&&o.push(p):o.push(p)}return o}},{key:"renderItem",value:function(e){var t=e.idx;return h.createElement(y,{key:"Image-"+t+"-"+e.src,isDir:void 0===e.src,item:e,index:t,DirItem:this.props.DirItem,margin:this.props.margin,height:this.props.rowHeight,isSelectable:this.props.enableImageSelection,onClick:this.getOnClickThumbnailFn(),onSelectImage:this.onSelectImage,tagStyle:this.props.tagStyle,tileViewportStyle:this.props.tileViewportStyle,thumbnailStyle:this.props.thumbnailStyle})}},{key:"render",value:function(){var r=this,e=this.props,t=e.isDraggable,i=e.onDrop,n=e.backButton,o=this.state,s=o.lightboxIsOpen,a=o.thumbnails,l=a.map(function(e,t){return void 0!==e.src&&(e.idx=t),r.renderItem(e)});return t||l.unshift(n),h.createElement("div",{id:this.props.id,className:"ReactGridGallery",ref:function(e){return r._gallery=e}},t&&a.length?h.createElement(E,{onDrop:i,items:a,bbtn:n,renderItem:this.renderItem}):l,h.createElement(p.ModalGateway,null,s&&a.length?h.createElement(p.Modal,{onClose:this.closeLightbox},h.createElement(c,{views:a,currentIndex:this.state.currentImage})):null))}}]),j);function j(e){var t;return r(this,j),(t=l(this,u(j).call(this,e))).state={images:t.props.images,thumbnails:[],lightboxIsOpen:t.props.isOpen,currentImage:t.props.currentImage,containerWidth:0},t.onResize=t.onResize.bind(a(t)),t.closeLightbox=t.closeLightbox.bind(a(t)),t.gotoImage=t.gotoImage.bind(a(t)),t.gotoNext=t.gotoNext.bind(a(t)),t.gotoPrevious=t.gotoPrevious.bind(a(t)),t.onClickImage=t.onClickImage.bind(a(t)),t.openLightbox=t.openLightbox.bind(a(t)),t.onSelectImage=t.onSelectImage.bind(a(t)),t.renderItem=t.renderItem.bind(a(t)),t}return W.displayName="Gallery",W.propTypes={images:e.arrayOf(e.shape({src:e.string.isRequired,nano:e.string,alt:e.string,thumbnail:e.string.isRequired,srcset:e.array,caption:e.string,tags:e.arrayOf(e.shape({value:e.string.isRequired,title:e.string.isRequired})),thumbnailWidth:e.number.isRequired,thumbnailHeight:e.number.isRequired,isSelected:e.bool,thumbnailCaption:e.oneOfType([e.string,e.element])})).isRequired,id:e.string,enableImageSelection:e.bool,onSelectImage:e.func,rowHeight:e.number,maxRows:e.number,margin:e.number,onClickThumbnail:e.func,lightboxWillOpen:e.func,lightboxWillClose:e.func,enableLightbox:e.bool,backdropClosesModal:e.bool,currentImage:e.number,preloadNextImage:e.bool,customControls:e.arrayOf(e.node),currentImageWillChange:e.func,enableKeyboardInput:e.bool,imageCountSeparator:e.string,isOpen:e.bool,isDraggable:e.bool,onDrop:e.func,onClickImage:e.func,onClickNext:e.func,onClickPrev:e.func,onClose:e.func,showCloseButton:e.bool,showImageCount:e.bool,lightboxWidth:e.number,tileViewportStyle:e.func,thumbnailStyle:e.func,showLightboxThumbnails:e.bool,onClickLightboxThumbnail:e.func,tagStyle:e.object},W.defaultProps={id:"ReactGridGallery",enableImageSelection:!0,rowHeight:180,margin:2,enableLightbox:!0,backdropClosesModal:!1,currentImage:0,preloadNextImage:!0,enableKeyboardInput:!0,imageCountSeparator:" of ",isOpen:!1,showCloseButton:!0,showImageCount:!0,lightboxWidth:1024,showLightboxThumbnails:!1},W});
